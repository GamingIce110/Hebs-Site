<!DOCTYPE html>
<html>
<head>
  <title>HEBS Vault</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getStorage, ref, uploadBytes, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDc4txFkjXsN6ds8bZannRwECTR1T-Y1Z4",
      authDomain: "hebs-3daa8.firebaseapp.com",
      databaseURL: "https://hebs-3daa8-default-rtdb.firebaseio.com",
      projectId: "hebs-3daa8",
      storageBucket: "hebs-3daa8.appspot.com",
      messagingSenderId: "401317379209",
      appId: "1:401317379209:web:48ff3bad41915e499e1a58"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const storage = getStorage();

    onAuthStateChanged(auth, user => {
      if (!user) {
        alert("Not logged in");
        window.location.href = "index.html";
      } else {
        const uid = user.uid;

        // Upload handler
        document.getElementById('uploadBtn').onclick = async () => {
          const file = document.getElementById('fileInput').files[0];
          if (!file) return alert("Choose a file");

          const fileRef = ref(storage, `vault/${uid}/${file.name}`);
          await uploadBytes(fileRef, file);
          alert("Uploaded!");

          loadFiles();
        };

        // Load file list
        async function loadFiles() {
          const listRef = ref(storage, `vault/${uid}`);
          const result = await listAll(listRef);
          const linksDiv = document.getElementById('files');
          linksDiv.innerHTML = '';

          for (const item of result.items) {
            const url = await getDownloadURL(item);
            const a = document.createElement('a');
            a.href = url;
            a.textContent = item.name;
            a.target = "_blank";
            linksDiv.appendChild(a);
            linksDiv.appendChild(document.createElement("br"));
          }
        }

        loadFiles();
      }
    });

    function logout() {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      });
    }
  </script>
</head>
<body style="background-color:black; color:lime; font-family:monospace;">
  <h2>ðŸ“‚ HEBS File Vault</h2>
  <input type="file" id="fileInput">
  <button id="uploadBtn">Upload</button>
  <button onclick="logout()">Logout</button>
  <hr>
  <div id="files"></div>
</body>
</html>